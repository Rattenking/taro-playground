(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{"147":function(e,t,n){"use strict";n.d(t,"c",(function(){return i})),n.d(t,"b",(function(){return s})),n.d(t,"d",(function(){return loadPage})),n.d(t,"a",(function(){return hadlePermissionsDeny})),n.d(t,"f",(function(){return throttle})),n.d(t,"e",(function(){return randomColor}));var r=n(25),c=n(17),o=n(305),a=n(150),i=r.a.getEnv()===r.a.ENV_TYPE.WEB,s=r.a.getEnv()===r.a.ENV_TYPE.RN;function loadPage(e){var t=e.url,n=e.title,r=e.right,o=e.open,a=e.certified,s=void 0===a||a;i?window.location.href=t:Object(c.e)({"url":"/pages/webview/index?certified=".concat(s,"&title=").concat(n,"&link=").concat(encodeURIComponent(t)).concat(r?"&right=".concat(r):"").concat(o?"&open=".concat(encodeURIComponent(o)):"")})}function hadlePermissionsDeny(e){var t=e.perssionText;Object(o.d)({"title":"提示","content":"请在“设置-隐私-".concat(t,"”选项中，允许 Taro 访问你的").concat(t,"。"),"confirmColor":"#6190E8","success":function success(e){e.confirm&&Object(a.b)()}})}function throttle(e,t){var n=0;return function(){var r=Date.now(),c=this,o=arguments;r-n>t&&(e.apply(c,o),n=r)}}function randomColor(){return"#".concat(Math.floor(16777215*Math.random()).toString(16))}},"150":function(e,t,n){"use strict";n.d(t,"b",(function(){return c})),n.d(t,"a",(function(){return o}));var r=n(9),c=Object(r.i)("openSetting"),o=Object(r.i)("getSetting")},"165":function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(9),c=(Object(r.i)("authorizeForMiniProgram"),Object(r.i)("authorize"))},"237":function(e,t,n){},"304":function(e,t,n){"use strict";n.r(t);var r=n(34),c=n(16),o=n(22),a=n.n(o),i=n(18),s=n(150),l=n(165),u=n(9),d=Object(u.i)("saveImageToPhotosAlbum"),p=(Object(u.i)("previewMedia"),Object(u.i)("compressImage")),f=(Object(u.i)("chooseMessageFile"),n(305)),m=n(15),g=function(){var e=Object(r.a)(a.a.mark((function _callee(e){var t,n,r,c,o,i,s,l,d,p,f,g,h,b,v,j,w;return a.a.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:if(t=function _loadImage(e,t){return new Promise((function(n){var r=document.createElement("taro-swiper-item-core");r.style.cssText="display:flex;align-items:start;justify-content:center;overflow-y:scroll;";var c=new Image;c.style.maxWidth="100%",c.src=e;var o=document.createElement("div");o.style.cssText="display:flex;align-items:center;justify-content:center;max-width:100%;min-height:100%;",o.appendChild(c),r.appendChild(o),n(r),"function"==typeof t&&c.addEventListener("error",(function(e){t({"errMsg":e.message})}))}))},(n=Object(u.h)(e)).flag){a.next=6;break}return r={"errMsg":"previewImage:fail ".concat(n.msg)},console.error(r.errMsg),a.abrupt("return",Promise.reject(r));case 6:return c=e.urls,o=void 0===c?[]:c,i=e.current,s=void 0===i?"":i,l=e.success,d=e.fail,p=e.complete,f=new m.b({"name":"previewImage","success":l,"fail":d,"complete":p}),(g=document.createElement("div")).classList.add("preview-image"),g.style.cssText="position:fixed;top:0;left:0;z-index:1050;width:100%;height:100%;overflow:hidden;outline:0;background-color:#111;",g.addEventListener("click",(function(){g.remove()})),(h=document.createElement("taro-swiper-core")).full=!0,b=[],a.prev=15,a.next=18,Promise.all(o.map((function(e){return t(e,d)})));case 18:b=a.sent,a.next=24;break;case 21:return a.prev=21,a.t0=a.catch(15),a.abrupt("return",f.fail({"errMsg":a.t0}));case 24:for(v=0;v<b.length;v++)j=b[v],h.appendChild(j);return w=o.indexOf(s),h.current=w,g.appendChild(h),document.body.appendChild(g),a.abrupt("return",f.success());case 30:case"end":return a.stop()}}),_callee,null,[[15,21]])})));return function previewImage(t){return e.apply(this,arguments)}}(),h=n(12),b=2,v=function downloadFile(e){var t,n=e.url,r=e.header,c=e.success,o=e.fail,a=e.complete,i=new Promise((function(e,i){t=function createDownloadTask(e){var t,n=e.url,r=e.header,c=e.success,o=e.error,a="downloadFile",i=new XMLHttpRequest,s={"headersReceived":new m.a,"progressUpdate":new m.a};i.open("GET",n,!0),i.responseType="blob",function setHeader(e,t){var n;for(n in t)e.setRequestHeader(n,t[n])}(i,r),i.onprogress=function(e){var t=e.loaded,n=e.total;s.progressUpdate.trigger({"progress":Math.round(t/n*100),"totalBytesWritten":t,"totalBytesExpectedToWrite":n})},i.onreadystatechange=function(){i.readyState===b&&s.headersReceived.trigger({"header":i.getAllResponseHeaders()})},i.onload=function(){var e=i.response,t=i.status;c({"errMsg":"".concat(a,":ok"),"statusCode":t,"tempFilePath":window.URL.createObjectURL(e)})},i.onabort=function(){clearTimeout(t),o({"errMsg":"".concat(a,":fail abort")})},i.onerror=function(e){o({"errMsg":"".concat(a,":fail ").concat(e.message)})};var l=function abort(){i.abort()};!function send(){i.send(),t=setTimeout((function(){i.onabort=null,i.onload=null,i.onprogress=null,i.onreadystatechange=null,i.onerror=null,l(),o({"errMsg":"".concat(a,":fail timeout")})}),6e4)}();var u=s.headersReceived.add,d=s.headersReceived.remove,p=s.progressUpdate.add,f=s.progressUpdate.remove;return{"abort":l,"onHeadersReceived":u,"offHeadersReceived":d,"onProgressUpdate":p,"offProgressUpdate":f}}({"url":n,"header":r,"success":function success(t){c&&c(t),a&&a(t),e(t)},"error":function error(e){o&&o(e),a&&a(e),i(e)}})}));return i.headersReceive=t.onHeadersReceived,i.progress=t.onProgressUpdate,i.abort=t.abort,i},j=n(138),w=n(147),y=(n(237),n(137));t.default=function Index(){var e=Object(i.useState)("https://pic5.58cdn.com.cn/nowater/fangfe/n_v25a185c1657984016926f26af591912c4.jpg"),t=Object(c.a)(e,2),n=t[0],o=t[1],b=Object(i.useState)([]),O=Object(c.a)(b,2),x=O[0],I=O[1];return Object(y.jsxs)(j.B,{"className":"api-page","children":[Object(y.jsx)(j.B,{"className":"common-border","style":{"alignItems":"center"},"children":Object(y.jsx)(j.g,{"src":n})}),Object(y.jsx)(j.a,{"type":"primary","className":"api-page-btn-success","onClick":Object(r.a)(a.a.mark((function _callee(){return a.a.wrap((function _callee$(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(s.a)({});case 2:e.sent.authSetting["scope.writePhotosAlbum"]?d({"filePath":n}).then((function(){Object(f.e)({"title":"保存成功"})})).catch((function(e){console.log("失败：",e),Object(f.e)({"title":"保存失败","icon":"none"})})):Object(l.a)({"scope":"scope.writePhotosAlbum","fail":function fail(e){"authorize:denied/undetermined"!==e.errMsg&&"authorize:fail"!==e.errMsg||Object(w.a)({"perssionText":"照片"})}});case 4:case"end":return e.stop()}}),_callee)}))),"children":"Taro.saveImageToPhotosAlbum"}),Object(y.jsx)(j.a,{"type":"primary","className":"api-page-btn-success","onClick":function onClick(){g({"current":n,"urls":[n]})},"children":"Taro.previewImage"}),Object(y.jsx)(j.a,{"type":"primary","className":"api-page-btn-success","onClick":function onClick(){!function getImageInfo(e){var t=Object(u.h)(e);if(!t.flag){var n={"errMsg":"getImageInfo:fail ".concat(t.msg)};return console.error(n.errMsg),Promise.reject(n)}var r=function getBase64Image(e){try{var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var n=t.getContext("2d");return null==n||n.drawImage(e,0,0,e.width,e.height),t.toDataURL("image/png")}catch(e){console.error("getImageInfo:get base64 fail",e)}},c=e.src,o=e.success,a=e.fail,i=e.complete,s=new m.b({"name":"getImageInfo","success":o,"fail":a,"complete":i});new Promise((function(e,t){var n=new Image;n.crossOrigin="",n.onload=function(){s.success({"width":n.naturalWidth,"height":n.naturalHeight,"path":r(n)||c},e)},n.onerror=function(e){s.fail({"errMsg":e.message},t)},n.src=c}))}({"src":n,"success":function success(e){Object(f.e)({"title":"width: ".concat(e.width," \n height: ").concat(e.height),"icon":"none"})},"fail":function fail(e){console.log(e)}})},"children":"Taro.getImageInfo"}),Object(y.jsx)(j.a,{"type":"primary","className":"api-page-btn-success","onClick":function onClick(){0===x.length?Object(f.e)({"title":"请先点击 chooseImage 选择图片","icon":"none"}):p({"src":x[0],"quality":10,"success":function success(e){console.log(e.tempFilePath),o(e.tempFilePath)},"fail":function fail(e){console.log(e)}})},"children":"Taro.compressImage"}),Object(y.jsx)(j.a,{"type":"primary","className":"api-page-btn-success","onClick":function onClick(){!function chooseImage(e){var t=Object(u.h)(e);if(!t.flag){var n={"errMsg":"chooseImage:fail ".concat(t.msg)};return console.error(n.errMsg),Promise.reject(n)}var r=e.count,c=void 0===r?1:r,o=e.success,a=e.fail,i=e.complete,s=e.imageId,l=void 0===s?"taroChooseImage":s,d=e.sourceType,p=void 0===d?["album","camera"]:d,f=new m.b({"name":"chooseImage","success":o,"fail":a,"complete":i}),g={"tempFilePaths":[],"tempFiles":[]},b=p&&p.toString(),v=["user","environment","camera"];if(c&&"number"!=typeof c)return g.errMsg=Object(u.b)({"para":"count","correct":"Number","wrong":c}),f.fail(g);var j=document.getElementById(l);if(j)c>1?j.setAttribute("multiple","multiple"):j.removeAttribute("multiple"),v.indexOf(b)>-1?j.setAttribute("capture",b):j.removeAttribute("capture");else{var w=document.createElement("input");w.setAttribute("type","file"),w.setAttribute("id",l),c>1&&w.setAttribute("multiple","multiple"),v.indexOf(b)>-1&&w.setAttribute("capture",b),w.setAttribute("accept","image/*"),w.setAttribute("style","position: fixed; top: -4000px; left: -3000px; z-index: -300;"),document.body.appendChild(w),j=document.getElementById(l)}new Promise((function(e){var t=document.createEvent("MouseEvents");t.initEvent("click",!0,!0),j&&(j.dispatchEvent(t),j.onchange=function(t){var n=t.target;if(n){var r=n.files||[],c=Object(h.a)(r);c&&c.forEach((function(e){var t,n,r=new Blob([e],{"type":e.type}),c=URL.createObjectURL(r);null===(t=g.tempFilePaths)||void 0===t||t.push(c),null===(n=g.tempFiles)||void 0===n||n.push({"path":c,"size":e.size,"type":e.type,"originalFileObj":e})})),f.success(g,e),n.value=""}})}))}({"count":3,"sourceType":["album"],"success":function success(e){I(e.tempFilePaths),o(e.tempFilePaths[0])},"fail":function fail(e){console.log(e)}})},"children":"Taro.chooseImage"}),Object(y.jsx)(j.a,{"type":"primary","className":"api-page-btn-success","onClick":function onClick(){v({"url":"https://pic1.58cdn.com.cn/nowater/fangfe/n_v2e36a29a2a50d45fcaa02de3b2bf59919.png","success":function success(e){console.log(e),200==e.statusCode&&(Object(f.e)({"title":"下载完成（临时文件）","icon":"none"}),o(e.tempFilePath))},"fail":function fail(e){console.log("下载失败：",e),Object(f.e)({"title":"下载失败","icon":"none"})}})},"children":"Taro.downloadFile"})]})}}}]);